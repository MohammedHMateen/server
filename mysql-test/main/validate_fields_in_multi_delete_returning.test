--echo ####
--echo ## MDEV-12326: TEST SUITE FOR VALIDATING RETURNING FIELDS IN MULTIPLE TABLE DELETE RETURNING
--echo ####
--echo
--echo
--echo
--echo ## Table and View Creation
CREATE TABLE ANIMALS (name varchar(40) primary key, colour varchar(20) not null, weight int(4) not null );
--echo
CREATE TABLE HABITAT (habitat_name varchar(40) primary key, animal_name varchar(40) not null );
--echo
CREATE TABLE FOOD (food_name varchar(20) primary key, animal_name varchar(40) not null );
--echo
--echo ## Data Insertion
--echo
INSERT INTO ANIMALS VALUES ('Penguins','CounterShade',23) , ('Polar Bear','White',450) , ('Toucan','Dark Blue',1) , ('Camel','Brown',600) , ('Reindeer','Grey',200) RETURNING *;
--echo
INSERT INTO HABITAT VALUES ('Antarctica','Penguins') , ('Arctic','Polar Bear') , ('Rainforest','Toucan') , ('Desert','Camel') , ('Tundra','Reindeer') RETURNING *;
--echo
INSERT INTO FOOD VALUES ('Fish','Penguins') , ('Seals','Polar Bear') , ('Fruits','Toucan') , ('Oats','Camel') , ('Herbs','Reindeer') RETURNING *;
--echo
--echo ## MULTIPLE TABLE DELETE RETURNING FIELD TEST CASES
--echo
--echo %%Columns ANIMALS.height, HABITAT.weather, etc. are all invalid field names in the RETURNING LIST
--echo
DELETE FROM ANIMALS USING ANIMALS,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE 'H%' RETURNING ANIMALS.height; 
--echo
DELETE FROM ANIMALS USING ANIMALS,FOOD WHERE ANIMALS.name=FOOD.animal_name and Animals.colour='White' RETURNING ANIMALS.weight,FOOD.food_name,UPPER(FOOD.taste); 
--echo
DELETE FROM ANIMALS USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE '_Z%' RETURNING HABITAT.weather;
--echo
DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE 'H%' RETURNING FOOD.taste+HABITAT.weather;
--echo
ANALYZE DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Tundra' RETURNING ANIMALS.colour, name;
--echo
EXPLAIN DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Rainforest' RETURNING name, age;
--echo
EXPLAIN EXTENDED DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Desert' RETURNING FOOD.name;
--echo
EXPLAIN FORMAT = "json" DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Antarctica' RETURNING HABITAT.names;
--echo
--echo ## Clean Up
--echo
drop table ANIMALS;
drop table FOOD;
drop table HABITAT;

--echo ## Done
