####
## MDEV-12326: TEST SUITE FOR VALIDATING RETURNING FIELDS IN MULTIPLE TABLE DELETE RETURNING
####



## Table and View Creation
CREATE TABLE ANIMALS (name varchar(40) primary key, colour varchar(20) not null, weight int(4) not null );

CREATE TABLE HABITAT (habitat_name varchar(40) primary key, animal_name varchar(40) not null );

CREATE TABLE FOOD (food_name varchar(20) primary key, animal_name varchar(40) not null );

## Data Insertion

INSERT INTO ANIMALS VALUES ('Penguins','CounterShade',23) , ('Polar Bear','White',450) , ('Toucan','Dark Blue',1) , ('Camel','Brown',600) , ('Reindeer','Grey',200) RETURNING *;
name	colour	weight
Penguins	CounterShade	23
Polar Bear	White	450
Toucan	Dark Blue	1
Camel	Brown	600
Reindeer	Grey	200

INSERT INTO HABITAT VALUES ('Antarctica','Penguins') , ('Arctic','Polar Bear') , ('Rainforest','Toucan') , ('Desert','Camel') , ('Tundra','Reindeer') RETURNING *;
habitat_name	animal_name
Antarctica	Penguins
Arctic	Polar Bear
Rainforest	Toucan
Desert	Camel
Tundra	Reindeer

INSERT INTO FOOD VALUES ('Fish','Penguins') , ('Seals','Polar Bear') , ('Fruits','Toucan') , ('Oats','Camel') , ('Herbs','Reindeer') RETURNING *;
food_name	animal_name
Fish	Penguins
Seals	Polar Bear
Fruits	Toucan
Oats	Camel
Herbs	Reindeer

## MULTIPLE TABLE DELETE RETURNING FIELD TEST CASES

%%Columns ANIMALS.height, HABITAT.weather, etc. are all invalid field names in the RETURNING LIST

DELETE FROM ANIMALS USING ANIMALS,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE 'H%' RETURNING ANIMALS.height;
mysqltest: At line 26: query 'DELETE FROM ANIMALS USING ANIMALS,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE 'H%' RETURNING ANIMALS.height' failed: 1054: Unknown column 'ANIMALS.height' in 'field list'

DELETE FROM ANIMALS USING ANIMALS,FOOD WHERE ANIMALS.name=FOOD.animal_name and Animals.colour='White' RETURNING ANIMALS.weight,FOOD.food_name,UPPER(FOOD.taste);
mysqltest: At line 28: query 'DELETE FROM ANIMALS USING ANIMALS,FOOD WHERE ANIMALS.name=FOOD.animal_name and Animals.colour='White' RETURNING ANIMALS.weight,FOOD.food_name,UPPER(FOOD.taste)' failed: 1054: Unknown column 'FOOD.taste' in 'field list'

DELETE FROM ANIMALS USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE '_Z%' RETURNING HABITAT.weather;
mysqltest: At line 30: query 'DELETE FROM ANIMALS USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE '_Z%' RETURNING HABITAT.weather' failed: 1054: Unknown column 'HABITAT.weather' in 'field list'

DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE 'H%' RETURNING FOOD.taste+HABITAT.weather;
mysqltest: At line 32: query 'DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and FOOD.food_name LIKE 'H%' RETURNING FOOD.taste+HABITAT.weather' failed: 1054: Unknown column 'FOOD.taste' in 'field list'

ANALYZE DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Tundra' RETURNING ANIMALS.colour, name;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	r_rows	filtered	r_filtered	Extra
1	SIMPLE	HABITAT	const	PRIMARY	PRIMARY	42	const	1	NULL	100.00	NULL	
1	SIMPLE	FOOD	ALL	NULL	NULL	NULL	NULL	5	5.00	100.00	100.00	
1	SIMPLE	ANIMALS	eq_ref	PRIMARY	PRIMARY	42	test.FOOD.animal_name	1	1.00	100.00	100.00	

EXPLAIN DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Rainforest' RETURNING name, age;
mysqltest: At line 36: query 'EXPLAIN DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Rainforest' RETURNING name, age' failed: 1054: Unknown column 'age' in 'field list'

EXPLAIN EXTENDED DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Desert' RETURNING FOOD.name;
mysqltest: At line 38: query 'EXPLAIN EXTENDED DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Desert' RETURNING FOOD.name' failed: 1054: Unknown column 'FOOD.name' in 'field list'

EXPLAIN FORMAT = "json" DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Antarctica' RETURNING HABITAT.names;
mysqltest: At line 40: query 'EXPLAIN FORMAT = "json" DELETE FROM HABITAT USING ANIMALS,HABITAT,FOOD WHERE ANIMALS.name=FOOD.animal_name and HABITAT.habitat_name = 'Antarctica' RETURNING HABITAT.names' failed: 1054: Unknown column 'HABITAT.names' in 'field list'

## Clean Up

drop table ANIMALS;
drop table FOOD;
drop table HABITAT;
## Done
